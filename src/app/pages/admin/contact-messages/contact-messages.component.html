<div class="contact-messages-page">
  <div class="page-header">
    <div>
      <h2>Contact Messages</h2>
      <p class="subtitle" *ngIf="getTotalCount() > 0">
        {{ getTotalCount() }} total message{{ getTotalCount() !== 1 ? 's' : '' }}
        <span *ngIf="getUnreadCount() > 0" class="unread-badge">
          {{ getUnreadCount() }} unread
        </span>
      </p>
    </div>
  </div>

  <div *ngIf="errorMessage" class="error-message">
    {{ errorMessage }}
  </div>

  <!-- Filters Section -->
  <div class="filters-container">
    <div class="filters-row">
      <div class="filter-group">
        <label>Search by Name/Email</label>
        <input
          type="text"
          [(ngModel)]="nameFilter"
          (input)="onNameFilterChange()"
          placeholder="Enter name or email..."
          class="filter-input" />
      </div>

      <div class="filter-group">
        <label>Filter by Service</label>
        <input
          type="text"
          [(ngModel)]="serviceFilter"
          (input)="onServiceFilterChange()"
          placeholder="Enter service name..."
          class="filter-input" />
      </div>

      <div class="filter-group">
        <label>Date Filters</label>
        <button
          class="btn-toggle-date"
          [class.active]="showDateFilters"
          (click)="toggleDateFilters()">
          {{ showDateFilters ? 'Hide' : 'Show' }} Date Filter
        </button>
      </div>

      <div class="filter-group">
        <button class="btn-clear-filters" (click)="clearFilters()">
          Clear All
        </button>
      </div>
    </div>

    <div *ngIf="showDateFilters" class="date-filters-row">
      <div class="filter-group">
        <label>From Date</label>
        <input
          type="date"
          [(ngModel)]="dateFromFilter"
          (change)="onDateFilterChange()"
          class="filter-input" />
      </div>

      <div class="filter-group">
        <label>To Date</label>
        <input
          type="date"
          [(ngModel)]="dateToFilter"
          (change)="onDateFilterChange()"
          class="filter-input" />
      </div>
    </div>
  </div>

  <!-- Messages Table -->
  <div class="table-container">
    <div *ngIf="isLoading && filteredMessages.length === 0" class="loading">
      Loading messages...
    </div>
    <div *ngIf="!isLoading && filteredMessages.length === 0" class="empty-state">
      No contact messages found.
    </div>

    <table *ngIf="filteredMessages.length > 0" class="messages-table">
      <thead>
        <tr>
          <th>Status</th>
          <th>Name</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Service</th>
          <th>Message</th>
          <th>Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let message of filteredMessages"
          [class.unread-row]="!message.read"
          (click)="viewMessage(message)"
          class="table-row">
          <td>
            <span *ngIf="!message.read" class="unread-indicator" title="Unread">â—</span>
            <span *ngIf="message.read" class="read-indicator" title="Read">âœ“</span>
          </td>
          <td class="name-cell">{{ message.name }}</td>
          <td class="email-cell">
            <a [href]="'mailto:' + message.email">{{ message.email }}</a>
          </td>
          <td class="phone-cell">
            <span *ngIf="message.phone">
              <a [href]="'tel:' + message.phone">{{ message.phone }}</a>
            </span>
            <span *ngIf="!message.phone" class="no-phone">-</span>
          </td>
          <td>
            <span class="service-badge">{{ message.service }}</span>
          </td>
          <td class="message-cell">
            {{ message.message.substring(0, 50) }}{{ message.message.length > 50 ? '...' : '' }}
          </td>
          <td class="date-cell">{{ formatDateShort(message.createdAt) }}</td>
          <td class="actions-cell" (click)="$event.stopPropagation()">
            <button
              class="btn-toggle-read"
              [class.read]="message.read"
              (click)="toggleReadStatus(message)"
              [title]="message.read ? 'Mark as unread' : 'Mark as read'">
              {{ message.read ? 'âœ“' : 'â—‹' }}
            </button>
            <button
              class="btn-delete"
              (click)="deleteMessage(message.id)"
              title="Delete message">
              ğŸ—‘ï¸
            </button>
            <button
              class="btn-view"
              (click)="viewMessage(message)"
              title="View details">
              ğŸ‘ï¸
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Message Detail Modal -->
  <div *ngIf="showModal && selectedMessage" class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Message Details</h3>
        <button class="close-btn" (click)="closeModal()">&times;</button>
      </div>
      
      <div class="modal-body">
        <div class="detail-section">
          <label>Name</label>
          <p>{{ selectedMessage.name }}</p>
        </div>

        <div class="detail-section">
          <label>Email</label>
          <p>
            <a [href]="'mailto:' + selectedMessage.email">{{ selectedMessage.email }}</a>
          </p>
        </div>

        <div class="detail-section" *ngIf="selectedMessage.phone">
          <label>Phone</label>
          <p>
            <a [href]="'tel:' + selectedMessage.phone">{{ selectedMessage.phone }}</a>
          </p>
        </div>

        <div class="detail-section">
          <label>Service Interested In</label>
          <p class="service-badge">{{ selectedMessage.service }}</p>
        </div>

        <div class="detail-section">
          <label>Message</label>
          <p class="message-text">{{ selectedMessage.message }}</p>
        </div>

        <div class="detail-section">
          <label>Received</label>
          <p>{{ formatDate(selectedMessage.createdAt) }}</p>
        </div>

        <div class="detail-section">
          <label>Status</label>
          <p>
            <span [class]="selectedMessage.read ? 'status-read' : 'status-unread'">
              {{ selectedMessage.read ? 'âœ“ Read' : 'â—‹ Unread' }}
            </span>
          </p>
        </div>
      </div>

      <div class="modal-actions">
        <button
          class="btn-toggle-read"
          [class.read]="selectedMessage.read"
          (click)="toggleReadStatus(selectedMessage!)">
          {{ selectedMessage.read ? 'Mark as Unread' : 'Mark as Read' }}
        </button>
        <button
          class="btn-delete"
          (click)="deleteMessage(selectedMessage.id)">
          Delete Message
        </button>
      </div>
    </div>
  </div>
</div>

